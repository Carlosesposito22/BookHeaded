{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    .superholder {
        display: flex;
        flex-direction: row;
        gap: 2rem;
    }

    .badges{
        background-color: white;
        width: 25%;
        border-radius: 1rem;
        padding: 1rem;
        padding-left: 2rem;
    }

    .badges-text{
        font-weight: bold;
        font-size: 2rem;
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 1rem;
    }

    .hold {
        width: 60%;
        border-top-right-radius: 2rem;
        border-top-left-radius: 2rem;
    }


    .pfp-holder {
        height: 7rem;
        width: 7rem;
        border-radius: 100%;
        margin-top: -3rem;
        cursor: pointer;
    }


    .banner {
        background-color: #0066FF;
        height: 10rem;
        border-top-right-radius: 2rem;
        border-top-left-radius: 2rem;
        display: flex;
        flex-direction: row;
        justify-content: right;
        padding: 1rem;
        padding-right: 1.5rem;
    }


    .rest {
        background-color: white;
        height: 20rem;
        padding: 1rem 2rem;
        display: flex;
        flex-direction: row;
        justify-content: space-between;
    }


    .biodiv {
        background-color: rgb(236, 236, 236);
        max-width: 30rem;
        padding: 0.5rem;
        margin-top: 1rem;
        border-radius: 1rem;
    }


    .bio{
        margin: 0;
    }


    .user-data {
        background-color: aqua;
        width: fit-content;
    }


    .follow {
        background-color: #0066FF;
        border: none;
        border-radius: 2rem;
        padding: 0.2rem 1rem;
        color: white;
        font-weight: bold;
    }


    .follow:hover {
        background-color: #004bbb;
        color: white;
    }


    .bio-form {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }


    .bio-form textarea {
        width: 100%;
        height: 5rem;
        padding: 0.5rem;
        border-radius: 0.5rem;
        border: 1px solid #ccc;
        resize: none;
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
    }


    .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 500px;
        text-align: center;
    }


    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        text-align: right;
        height: fit-content;
    }


    .close:hover,
    .close:focus {
        color: black;
    }


    .icon-options {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        justify-content: space-around;
        border-radius: 1rem;
        padding: 0;
        padding: 1rem;
        border-style: solid;
        border-color: #d8d8d8;
        border-width: 0.05rem;
        align-items: center;
    }


    .icon {
        cursor: pointer;
    }


    .icon img {
        height: 4rem;
        width: auto;
    }


    .img-user{
        width: fit-content;
        height: fit-content;
        display: flex;
        flex-direction: row;
        gap: 3rem;
    }


    .img-user:hover img {
        filter: brightness(70%);
    }


    .user-n-follow{
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        align-items: center;
        margin-top: 0.5rem;
        gap: 0.5rem;
    }


    #following-text{
        background: none;
        box-shadow: inset 0 0 0 2.5px #0066FF;
        border: none;
        color: #0066FF;
    }


    #following-text:hover{
        background: none;
        box-shadow: inset 0 0 0 2.5px #c00000;
        border: none;
        color: #c00000;
    }

    .modaltitle-close{
        display: flex;
        flex-direction: row;
        justify-content: space-between;
    }

    #bio-form-modal{
        margin-top: 2rem;
    }

    #modal-icon:hover{
        opacity: 50%;
    }

</style>



<div class="container my-5 superholder">
    <div class="badges shadow-lg">
        <p class="badges-text"><i class="bi bi-trophy-fill" style="color: #0066FF;"></i> Badges</p>
    </div>
    <div class="col hold shadow-lg">
        <div class="banner">
            {% if request.user == profile.user %}
            <i class="bi bi-pencil-fill" onclick="openModal()" style="color: white; cursor: pointer;"></i>
            {% endif %}
        </div>
        <div class="rest">
            <div class="img-user-bio">
                <div class="img-user-div">
                    {% if request.user == profile.user %}
                        <div class="img-user" onclick="openModal()">
                            <img src="{% if profile.icone %}{% static profile.icone %}{% else %}{% static 'images/icon3.svg' %}{% endif %}" alt="Foto de perfil" class="pfp-holder">
                            <strong> Followers</strong> <!-- Aqui tem que aparecer antes do 'Followers' o numero de followers -->
                            <strong> Following</strong> <!-- Mesma logica aqui -->
                        </div>
                    {% else %}
                        <div class="img-user">
                            <img src="{% if profile.icone %}{% static profile.icone %}{% else %}{% static 'images/icon3.svg' %}{% endif %}" alt="Foto de perfil" class="pfp-holder">
                            <strong> Followers</strong> <!-- Aqui tem que aparecer antes do 'Followers' o numero de followers -->
                            <strong> Following</strong> <!-- Mesma logica aqui -->
                        </div>
                    {% endif %}
                    <div class="user-n-follow">
                        <strong class="username">@{{ profile.user.username }}</strong>
                        {% if request.user != profile.user %}
                            {% if request.user in profile.seguindo.all %}
                                <span class="btn follow" id="following-text">Following <i class="bi bi-check"></i></span>
                            {% else %}
                                <form method="post" action="{% url 'seguir_usuario' profile.user.id %}" style="display:inline;">
                                    {% csrf_token %}
                                    <button type="submit" class="btn follow">
                                        <i class="bi bi-plus"></i>
                                        Follow
                                    </button>
                                </form>
                            {% endif %}
                        {% endif %}
                    </div>
                    <div class="biodiv">
                        {% if request.user == profile.user %}
                            {% if profile.bio %}
                                <p class="text-break bio">{{ profile.bio }}</p>
                            {% else %}
                                <p>Olá, sou um novo bookheaded</p>
                            {% endif %}
                        {% else %}
                            {% if profile.bio %}
                                <p class="bio">{{ profile.bio }}</p>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="user-data">
                <p class="user-info">User Info</p>
            </div>
        </div>
    </div>
</div>

<!-- Modal para alterar o perfil -->
<div id="iconModal" class="modal" style="z-index: 999; ">
    <div class="modal-content">
        <span class="modaltitle-close">
            <h2><strong>Edit Profile</strong></h2>
            <span class="close">&times;</span>
        </span>

        <form class="bio-form" id="bio-form-modal" method="post" action="{% url 'profile' profile.user.id %}">
            {% csrf_token %}
            <input type="hidden" name="icone" id="icone-input" value="{{ profile.icone }}">
            <label style="width: fit-content; color: #494949; font-weight: 500;">Bio:</label>
            <textarea name="bio" placeholder="Write your bio here...">{{ profile.bio }}</textarea>
        
        
        <br>

        <div class="icons-n-label">
            <label style="width: fit-content; color: #494949; font-weight: 500;">Profile icon</label>
            <div class="icon-options">
                {% for icon in icons %}
                <button type="button" class="icon" id="modal-icon" onclick="chooseIcon('{{ icon }}')" style="border-style: none; border-radius: 100%;">
                    <img src="{% static icon %}" alt="Ícone">
                </button>
                {% endfor %}
            </div>
        </div>

        <br>

        <button class="btn btn-primary fw-bold save-bio" id="save-bio-modal" style="border-radius: 1rem;">Save Changes</button>
        </form>
        
    </div>
</div>

<script>
    function openModal() {
    document.getElementById('iconModal').style.display = 'block';
}

document.querySelector('.close').addEventListener('click', function() {
    document.getElementById('iconModal').style.display = 'none';
});

window.onclick = function(event) {
    const modal = document.getElementById('iconModal');
    if (event.target == modal) {
        modal.style.display = 'none';
    }
};

let selectedIcon = '';

function chooseIcon(iconSrc) {
    selectedIcon = iconSrc; // Armazena o ícone selecionado
}

document.querySelector('.bio-form').addEventListener('submit', function() {
    if (selectedIcon) {
        const newSrc = '{% static '' %}' + selectedIcon;
        document.querySelector('.pfp-holder').src = newSrc; // Atualiza a imagem do ícone
        document.getElementById('icone-input').value = selectedIcon; // Atualiza o campo oculto
    }
});

    
</script>
{% endblock %}
