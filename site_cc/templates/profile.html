{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    .superholder {
        display: flex;
        flex-direction: row;
        gap: 2rem;
        flex-wrap: wrap;
    }

    .hold {
        width: 60%;
        border-top-right-radius: 2rem;
        border-top-left-radius: 2rem;
        order: 1;
    }


    .pfp-holder {
        height: 7rem;
        width: 7rem;
        border-radius: 100%;
        margin-top: -3rem;
        cursor: pointer;
    }


    .banner {
        background-color: #0066FF;
        height: 10rem;
        border-top-right-radius: 2rem;
        border-top-left-radius: 2rem;
        display: flex;
        flex-direction: row;
        justify-content: right;
        padding: 1rem;
        padding-right: 1.5rem;
    }


    .rest {
        background-color: white;
        height: 20rem;
        padding: 1rem 2rem;
        display: flex;
        flex-direction: row;
        justify-content: space-between;
    }


    .biodiv {
        background-color: rgb(236, 236, 236);
        max-width: 30rem;
        padding: 0.5rem;
        margin-top: 1rem;
        border-radius: 1rem;
        width: fit-content;
        max-width: 80%;
    }


    .bio{
        margin: 0;
        width: fit-content;
    }


    .user-data {
        background-color: #ececec;
        width: fit-content;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-weight: bold;
    }


    .follow {
        background-color: #0066FF;
        border: none;
        border-radius: 2rem;
        padding: 0.2rem 1rem;
        color: white;
        font-weight: bold;
    }


    .follow:hover {
        background-color: #004bbb;
        color: white;
    }


    .bio-form {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }


    .bio-form textarea {
        width: 100%;
        height: 5rem;
        padding: 0.5rem;
        border-radius: 0.5rem;
        border: 1px solid #ccc;
        resize: none;
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
    }


    .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 500px;
        text-align: center;
    }


    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        text-align: right;
        height: fit-content;
    }


    .close:hover,
    .close:focus {
        color: black;
    }


    .icon-options {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        justify-content: space-around;
        border-radius: 1rem;
        padding: 0;
        padding: 1rem;
        border-style: solid;
        border-color: #d8d8d8;
        border-width: 0.05rem;
        align-items: center;
    }


    .icon {
        cursor: pointer;
    }


    .icon img {
        height: 4rem;
        width: auto;
    }


    .img-user{
        width: fit-content;
        height: fit-content;
        display: flex;
        flex-direction: row;
        gap: 3rem;
    }


    .pfp-holder:hover {
        filter: brightness(70%);
    }


    .user-n-follow{
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        align-items: center;
        margin-top: 0.5rem;
        gap: 0.5rem;
    }


    #following-text{
        background: none;
        box-shadow: inset 0 0 0 2.5px #0066FF;
        border: none;
        color: #0066FF;
    }


    #following-text:hover{
        background: none;
        box-shadow: inset 0 0 0 2.5px #c00000;
        border: none;
        color: #c00000;
    }

    .modaltitle-close{
        display: flex;
        flex-direction: row;
        justify-content: space-between;
    }

    #bio-form-modal{
        margin-top: 2rem;
    }

    #modal-icon:hover{
        opacity: 50%;
    }

    .bi-pencil-fill:hover{
        color: #dbdbdb !important;
    }

    .badges{
        background-color: white;
        width: 25%;
        border-radius: 1rem;
        padding: 1rem 2rem;
        order: 2;
    }

    .badges-text{
        font-weight: bold;
        font-size: 2rem;
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 1rem;
    }

    .badges-holder{
        width: 100%;
        height: auto;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .badges-ul{
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        list-style: none;
        gap: 0.5rem;
        justify-content: center;
        margin-top: 1rem;
        padding: 0;
    }

    .badges-li{
        background-color: rgb(202, 202, 202);
        border-radius: 0.5rem;
        width: 4.5rem;
        text-align: center;
        color: #888;
    }

    .bi-dot{
        font-size: 3rem;
    }

    .followdata-li{
        height: fit-content;
        width: 100%;
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: left;
    }

    .followdata-ul{
        gap: 1rem;
        display: flex;
        flex-direction: column;
        margin-top: 2rem;
    }

    .img-user-followdata{
        display: flex;
        flex-direction: row;
        gap: 1rem;
    }

    .close-followdata{
        font-size: 2rem;
        margin-top: -1rem;
    }

    .close-followdata:hover{
        cursor: pointer;
    }

    @media screen and (max-width: 767px){
        .badges{
            order: 2;
            width: 100%;
        }
        .hold{
            order: 1;
            width: 100%;
        }
        .superholder{
            flex-direction: column;
        }
        .img-user-bio{
            width: 100%;
        }
        .img-user{
            width: 100%;
            flex-wrap: wrap;
            gap: 1rem;
        }

    }

</style>



<div class="container my-5 superholder">
    <!-- Essa div é para mostrar os badges do usuário -->
    <div class="badges shadow-lg">
        <p class="badges-text"><i class="bi bi-trophy-fill" style="color: #0066FF;"></i> Badges</p>
        <hr>
        <div class="badges-holder">
            <ul class="badges-ul">
                <li class="badges-li">
                    <div class="nobadge-holder">
                        <i class="bi bi-dot"></i>
                    </div>
                </li>
                <li class="badges-li">
                    <div class="nobadge-holder">
                        <i class="bi bi-dot"></i>
                    </div>
                </li>
                <li class="badges-li">
                    <div class="nobadge-holder">
                        <i class="bi bi-dot"></i>
                    </div>
                </li>
                <li class="badges-li">
                    <div class="nobadge-holder">
                        <i class="bi bi-dot"></i>
                    </div>
                </li>
                <li class="badges-li">
                    <div class="nobadge-holder">
                        <i class="bi bi-dot"></i>
                    </div>
                </li>
                <li class="badges-li">
                    <div class="nobadge-holder">
                        <i class="bi bi-dot"></i>
                    </div>
                </li>
                <li class="badges-li">
                    <div class="nobadge-holder">
                        <i class="bi bi-dot"></i>
                    </div>
                </li>
                <li class="badges-li">
                    <div class="nobadge-holder">
                        <i class="bi bi-dot"></i>
                    </div>
                </li>
                <li class="badges-li">
                    <div class="nobadge-holder">
                        <i class="bi bi-dot"></i>
                    </div>
                </li>
                <li class="badges-li">
                    <div class="nobadge-holder">
                        <i class="bi bi-dot"></i>
                    </div>
                </li>
                <li class="badges-li">
                    <div class="nobadge-holder">
                        <i class="bi bi-dot"></i>
                    </div>
                </li>
                <li class="badges-li">
                    <div class="nobadge-holder">
                        <i class="bi bi-dot"></i>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    <div class="col hold shadow-lg">
        <div class="banner">
            {% if request.user == profile.user %}
            <i class="bi bi-pencil-fill" onclick="openModal()" style="color: white; cursor: pointer;"></i>
            {% endif %}
        </div>
        <div class="rest">
            <div class="img-user-bio">
                <div class="img-user-div">
                    {% if request.user == profile.user %}
                        <div class="img-user">
                            <img src="{% if profile.icone %}{% static profile.icone %}{% else %}{% static 'images/icon3.svg' %}{% endif %}" alt="Foto de perfil" class="pfp-holder"  onclick="openModal()">
                            <strong style="cursor: pointer;" onclick="openFollowersModal()">{{ seguidores_count }} Followers</strong> <!-- Aqui tem que aparecer antes do 'Followers' o numero de followers -->
                            
                           
                            <strong style="cursor: pointer;" onclick="openFollowingModal()">{{ seguindo_count }} Following</strong>
                        </div>
                    {% else %}
                        <div class="img-user">
                            <img src="{% if profile.icone %}{% static profile.icone %}{% else %}{% static 'images/icon3.svg' %}{% endif %}" alt="Foto de perfil" class="pfp-holder">
                            <strong style="cursor: pointer;" onclick="openFollowersModal()">{{ seguidores_count }} Followers</strong>  <!-- Aqui tem que aparecer antes do 'Followers' o numero de followers -->
                            <strong style="cursor: pointer;" onclick="openFollowingModal()">{{ seguindo_count }} Following</strong>
                        </div>
                    {% endif %}
                    <div class="user-n-follow">
                        <strong class="username">@{{ profile.user.username }}</strong>
                        {% if request.user != profile.user %}
                            {% if request.user in profile.seguidores.all %}
                           
                            <form method="POST" action="{% url 'seguir_usuario' user_id=profile.user.id %}">
                                {% csrf_token %}
                                <button type="submit" span class="btn follow" id="following-text">Unfollow <i class="bi bi-check"></i></span></button>
                            </form>
                        {% else %}
                            
                            <form method="POST" action="{% url 'seguir_usuario' user_id=profile.user.id %}">
                                {% csrf_token %}
                                <button type="submit" span class="btn follow" id="following-text">Follow<i class="bi bi-check"></i></span></button>
                            </form>
                        {% endif %}
                    {% endif %}
                    </div>
                    <div class="biodiv">
                        {% if request.user == profile.user %}
                            {% if profile.bio %}
                                <p class="text-break bio">{{ profile.bio }}</p>
                            {% else %}
                                <p>Olá, sou um novo bookheaded</p>
                            {% endif %}
                        {% else %}
                            {% if profile.bio %}
                                <p class="bio">{{ profile.bio }}</p>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="user-data">
                <p class="user-info">User Info</p>
            </div>
        </div>
    </div>
</div>

<!-- mamed esse e o modal para alterar o perfil -->
<div id="iconModal" class="modal" style="z-index: 999; ">
    <div class="modal-content">
        <span class="modaltitle-close">
            <h2><strong>Edit Profile</strong></h2>
            <span class="close">&times;</span>
        </span>

        <form class="bio-form" id="bio-form-modal" method="post" action="{% url 'profile' profile.user.id %}">
            {% csrf_token %}
            <input type="hidden" name="icone" id="icone-input" value="{{ profile.icone }}">
            <label style="width: fit-content; color: #494949; font-weight: 500;">Bio:</label>
            <textarea name="bio" placeholder="Write your bio here...">{{ profile.bio }}</textarea>
        
        
        <br>

        <div class="icons-n-label">
            <label style="width: fit-content; color: #494949; font-weight: 500;">Profile icon</label>
            <div class="icon-options">
                {% for icon in icons %}
                <button type="button" class="icon" id="modal-icon" onclick="chooseIcon('{{ icon }}')" style="border-style: none; border-radius: 100%;">
                    <img src="{% static icon %}" alt="Ícone">
                </button>
                {% endfor %}
            </div>
        </div>

        <br>

        <button class="btn btn-primary fw-bold save-bio" id="save-bio-modal" style="border-radius: 1rem;">Save Changes</button>
        </form>
        
    </div>
</div>

<!-- mamemd esse e o modal para mostrar os perfis que te seguem seguidos -->
<div id="followersModal" class="modal">
    <div class="modal-content">
        <span class="modaltitle-close">
            <h2><strong>Seguidores</strong></h2>
            <span class="close-followdata">&times;</span>
        </span>

        <ul class="followdata-ul" style="list-style: none; padding: 0;">
            {% for seguidor in seguidores %}
            <li class="followdata-li">
                <div class="img-user-followdata">
                    <img src="{% if seguidor.profile.icone %}{% static seguidor.profile.icone %}{% else %}{% static 'images/icon3.svg' %}{% endif %}" alt="foto do perfil" style="height: 2rem;">
                    <a href="{% url 'profile' seguidor.id %}" style="text-decoration: none;">@{{ seguidor.username }}</a>

                </div>
            </li>
            {% empty %}
            <li>No followers found.</li>
            {% endfor %}
        </ul>
    </div>
</div>

<div id="followingModal" class="modal" style="z-index: 999;">
    <div class="modal-content">
        <span class="modaltitle-close">
            <h2><strong>Following</strong></h2>
            <span class="close" onclick="closeFollowingModal()">&times;</span>
        </span>

        <ul class="followdata-ul" style="list-style: none; padding: 0;">
            {% for usuario in seguindo %}
                <li class="followdata-li">
                    <div class="img-user-followdata">
                        <img src="{% if usuario.icone %}{% static usuario.icone %}{% else %}{% static 'images/icon3.svg' %}{% endif %}" alt="foto do perfil" style="height: 2rem;">
                        <a href="{% url 'profile' usuario.user.id %}">@{{ usuario.user.username }}</a>
                    </div> 
                </li>
            {% empty %}
                <li>No followers found.</li>
            {% endfor %}
        </ul>
    </div>
</div>




<script>
    function openModal() {
    document.getElementById('iconModal').style.display = 'block';
}

document.querySelector('.close').addEventListener('click', function() {
    document.getElementById('iconModal').style.display = 'none';
});

window.onclick = function(event) {
    const modal = document.getElementById('iconModal');
    if (event.target == modal) {
        modal.style.display = 'none';
    }
};

let selectedIcon = '';

function chooseIcon(iconSrc) {
    selectedIcon = iconSrc; 
}

document.querySelector('.bio-form').addEventListener('submit', function() {
    if (selectedIcon) {
        const newSrc = '{% static '' %}' + selectedIcon;
        document.querySelector('.pfp-holder').src = newSrc; 
        document.getElementById('icone-input').value = selectedIcon; 
    }
});
function openFollowersModal() {
    document.getElementById('followersModal').style.display = 'block';
}


document.querySelector('.close-followdata').addEventListener('click', function() {
    document.getElementById('followersModal').style.display = 'none';
});


window.onclick = function(event) {
    const modal = document.getElementById('followersModal');
    if (event.target == modal) {
        modal.style.display = 'none';
    }
};

function openFollowingModal() {
    document.getElementById("followingModal").style.display = "block";
}


function closeFollowingModal() {
    document.getElementById("followingModal").style.display = "none";
}


window.onclick = function(event) {
    const followingModal = document.getElementById("followingModal");
    if (event.target == followingModal) {
        closeFollowingModal();
    }
};
   

    
</script>
{% endblock %}
