{% extends 'base.html' %}
{% load static %}

{% block content %}

<style>
    .superholder {
        display: flex;
        flex-direction: row;
        gap: 2rem;
    }

    .hold {
        width: 60%;
        border-top-right-radius: 2rem;
        border-top-left-radius: 2rem;
    }

    .pfp-holder {
        background-color: black;
        height: 7rem;
        width: 7rem;
        border-radius: 100%;
        margin-top: -3rem;
        cursor: pointer;
    }

    .banner {
        background-color: pink;
        height: 10rem;
        border-top-right-radius: 2rem;
        border-top-left-radius: 2rem;
    }

    .rest {
        background-color: white;
        height: 20rem;
        padding: 1rem 2rem;
        display: flex;
        flex-direction: row;
        justify-content: space-between;
    }

    .biodiv {
        background-color: grey;
        max-width: 60%;
        padding: 0.5rem;
        margin-top: 1rem;
    }

    .user-data {
        background-color: aqua;
        width: fit-content;
    }

    .follow {
        background-color: #0066FF;
        border: none;
        border-radius: 2rem;
        padding: 0.5rem 1rem;
        color: white;
        font-weight: bold;
    }

    .follow:hover {
        background-color: #004bbb;
    }

    strong {
        display: flex;
        flex-direction: row;
        gap: 0.5rem;
        align-items: center;
        justify-content: center;
        margin-top: 1rem;
    }

    .bio-form {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin-top: 1rem;
    }

    .bio-form textarea {
        width: 100%;
        height: 5rem;
        padding: 0.5rem;
        border-radius: 0.5rem;
        border: 1px solid #ccc;
        resize: none;
    }

    /* Estilos do Modal */
    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 500px;
        text-align: center;
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
    }

    .close:hover,
    .close:focus {
        color: black;
    }

    .icon-options {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        justify-content: center;
        background-color: #dddddd;
        border-radius: 1rem;
        padding: 1rem;
    }

    .icon {
        cursor: pointer;
    }

    .icon img {
        height: 4rem;
        width: auto;
    }

    .icon img:hover {
        
    }
</style>

<div class="container my-5 superholder">
    <div class="col hold shadow-lg">
        <div class="banner"></div>
        <div class="rest">
            <div class="img-user-bio">
                <div class="img-user">
                    {% if request.user == profile.user %}
                        <div class="img-user" onclick="openModal()">
                            <img src="{% if profile.icone %}{% static profile.icone %}{% else %}{% static 'images/icon3.svg' %}{% endif %}" alt="Foto de perfil" class="pfp-holder">
                        </div>
                    {% else %}
                        <div class="img-user">
                            <img src="{% if profile.icone %}{% static profile.icone %}{% else %}{% static 'images/icon3.svg' %}{% endif %}" alt="Foto de perfil" class="pfp-holder">
                        </div>
                    {% endif %}
                    <strong class="username">@{{ profile.user.username }}
                        <div class="biodiv">
                            {% if request.user == profile.user %}
                                {% if profile.bio %}
                                    <p class="bio">{{ profile.bio }}</p>
                                {% else %}
                                    <form class="bio-form" method="post">
                                        {% csrf_token %}
                                        <textarea name="bio" placeholder="Digite sua bio aqui..."></textarea>
                                        <button type="submit">Salvar Bio</button>
                                    </form>
                                {% endif %}
                            {% else %}
                                {% if profile.bio %}
                                    <p class="bio">{{ profile.bio }}</p>
                                {% endif %}
                            {% endif %}
                        </div>
                        {% if request.user != profile.user %}
                            {% if request.user in profile.seguindo.all %}
                                <span class="following-text">Você está seguindo</span>
                            {% else %}
                                <form method="post" action="{% url 'seguir_usuario' profile.user.id %}" style="display:inline;">
                                    {% csrf_token %}
                                    <button type="submit" class="btn follow">
                                        <i class="bi bi-plus"></i>
                                        Follow
                                    </button>
                                </form>
                            {% endif %}
                        {% endif %}
                    </strong>
                </div>
            </div>
            <div class="user-data">
                <p class="user-info">User Info</p>
            </div>
        </div>
    </div>
</div>

<!-- Modal para escolher ícone -->
<div id="iconModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Escolha seu ícone</h2>
        <br>
        <div class="icon-options">
            <div class="icon" onclick="chooseIcon('images/icon1.svg')">
                <img src="{% static 'images/icon1.svg' %}" alt="Icon 1">
            </div>
            <div class="icon" onclick="chooseIcon('images/icon2.svg')">
                <img src="{% static 'images/icon2.svg' %}" alt="Icon 2">
            </div>
            <div class="icon" onclick="chooseIcon('images/icon3.svg')">
                <img src="{% static 'images/icon3.svg' %}" alt="Icon 3">
            </div>
            <div class="icon" onclick="chooseIcon('images/icon4.svg')">
                <img src="{% static 'images/icon4.svg' %}" alt="Icon 4">
            </div>
            <div class="icon" onclick="chooseIcon('images/icon5.svg')">
                <img src="{% static 'images/icon5.svg' %}" alt="Icon 5">
            </div>
            <div class="icon" onclick="chooseIcon('images/icon6.svg')">
                <img src="{% static 'images/icon6.svg' %}" alt="Icon 6">
            </div>
            <div class="icon" onclick="chooseIcon('images/icon7.svg')">
                <img src="{% static 'images/icon7.svg' %}" alt="Icon 7">
            </div>
            <div class="icon" onclick="chooseIcon('images/icon8.svg')">
                <img src="{% static 'images/icon8.svg' %}" alt="Icon 8">
            </div>
            <div class="icon" onclick="chooseIcon('images/icon9.svg')">
                <img src="{% static 'images/icon9.svg' %}" alt="Icon 9">
            </div>
            <div class="icon" onclick="chooseIcon('images/icon10.svg')">
                <img src="{% static 'images/icon10.svg' %}" alt="Icon 10">
            </div>

        </div>
    </div>
</div>

<script>
    function openModal() {
        document.getElementById('iconModal').style.display = 'block';
    }

    document.querySelector('.close').addEventListener('click', function() {
        document.getElementById('iconModal').style.display = 'none';
    });

    window.onclick = function(event) {
        const modal = document.getElementById('iconModal');
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    };

    function chooseIcon(iconSrc) {
        const newSrc = '{% static '' %}' + iconSrc;
        document.querySelector('.pfp-holder').src = newSrc;

        const formData = new FormData();
        formData.append('icone', iconSrc);

        fetch("{% url 'profile' profile.user.id %}", {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: formData
        })
        .then(response => {
            if (response.ok) {
                console.log('Ícone salvo com sucesso!');
            } else {
                console.error('Erro ao salvar ícone.');
            }
        })
        .catch(error => console.error('Erro na requisição:', error));

        document.getElementById('iconModal').style.display = 'none';
    }
</script>

{% endblock %}
