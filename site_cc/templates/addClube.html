{% extends 'base.html' %}

{% block title %}
    Criando
{% endblock title %}

{% block content %}

{% load static %}

<style>
    body {
        font-family: 'DM Sans', 'sans-serif';
        background-color: white;
    }

    .row {
        height: fit-content;
        width: 30rem;
        display: flex;
        position: relative;
        flex-direction: column;
    }

    label {
        color: black;
        font-size: 1rem;
        font-weight: bold;
    }

    .holder1 {
        height: fit-content;
        width: fit-content;
        display: flex;
        flex-direction: row;
        gap: 10rem;
    }

    .form-check-input {
        border-style: solid;
        border-width: .1rem;
        border-color: rgb(202, 202, 202);
    }

    .create-btn {
        display: flex;
        position: relative;
    }

    .form-img {
        margin-top: 2rem;
        height: 20rem;
        width: 20rem;
    }

    .holder2 {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .reading-club {
        font-size: 4rem;
        margin-top: -.8rem;
    }

    .superholder {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 4rem;
    }

    textarea {
        height: 6rem;
        width: 100%;
    }

    .form-group {
        border-style: solid;
        border-color: rgb(202, 202, 202);
        padding-top: .5rem;
        padding-bottom: 1rem;
        border-radius: 1rem;
        margin-bottom: 1rem;
    }

    .error-message {
        color: red;
        font-size: 0.9rem;
        display: none;
    }

</style>

{% if user.is_authenticated %}

    <div class="superholder">
        <div class="holder1">
            <div class="holder2">
                <h1 class="text-start text-black">Create your new <p class="h1 fw-bold reading-club">reading club</p></h1>
                <img src="{% static 'images/create-club-pic.png' %}" class="form-img">
            </div>
            <div class="container-start">
                <div class="row">
                    <div class="form-group shadow-lg">
                        <form method="post" id="create-club-form">
                            {% csrf_token %}
                            
                            <label for="titulo">Título:</label>
                            <input type="text" name="titulo" id="titulo" required>

                            <label for="modalidade">Modalidade:</label>
                            <select name="modalidade" id="modalidade" required>
                                <option value="">Selecione uma modalidade</option>
                                {% for modalidade in modalidades %}
                                    <option value="{{ modalidade.id }}">{{ modalidade.nome }}</option>
                                {% endfor %}
                            </select>

                            <label for="categoria">Categoria:</label>
                            <select name="categoria" id="categoria" required>
                                <option value="">Selecione uma categoria</option>
                                {% for categoria in categorias %}
                                    <option value="{{ categoria.id }}">{{ categoria.nome }}</option>
                                {% endfor %}
                            </select>

                            <label for="descricao">Descrição:</label>
                            <textarea name="descricao" id="descricao" required></textarea>

                            <label for="sobre">Sobre:</label>
                            <textarea name="sobre" id="sobre" required></textarea>

                            <div>
                                <input type="checkbox" name="privado" id="privado">
                                <label for="privado">Privado</label>
                            </div>

                            <input type="hidden" id="moderador" name="moderador">

                            <button class="btn btn-primary btn-lg create-btn" id="create-btn" disabled>Criar</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function validateField(field) {
            const value = field.value.trim();
            if (field.type === "checkbox") {
                return true; 
            }
            return value !== '';
        }

        function validateForm() {
            const form = document.getElementById("create-club-form");
            const fields = form.querySelectorAll("input, textarea, select");
            let allValid = true;

            fields.forEach(field => {
                if (!(field.type === "checkbox" && field.id === "privado")) {
                    if (!validateField(field)) {
                        allValid = false;
                    }
                }
            });

            return allValid;
        }

        function toggleSubmitButton() {
            const button = document.getElementById("create-btn");
            if (validateForm()) {
                button.removeAttribute("disabled");
            } else {
                button.setAttribute("disabled", "true");
            }
        }

        document.querySelectorAll("input, textarea, select").forEach(input => {
            input.addEventListener("input", toggleSubmitButton);
            if (input.type === "checkbox") {
                input.addEventListener("change", toggleSubmitButton);
            }
        });

        var name = "{{ user.id }}";
        document.getElementById("moderador").value = name;
    </script>

{% else %}
    Você não tem permissão para criar um Clube
{% endif %}

{% endblock %}
